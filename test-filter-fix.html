<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Correction Filtres Avanc√©s - TaskMaster AI</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section.passed {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        .test-section.failed {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #374151;
        }
        .test-result {
            font-weight: 600;
            margin-bottom: 8px;
        }
        .test-result.passed {
            color: #059669;
        }
        .test-result.failed {
            color: #dc2626;
        }
        .test-description {
            color: #6b7280;
            margin-bottom: 16px;
        }
        .test-steps {
            background: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .test-steps li {
            margin-bottom: 8px;
            color: #374151;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.passed {
            background-color: #10b981;
        }
        .status-indicator.failed {
            background-color: #ef4444;
        }
        .status-indicator.pending {
            background-color: #f59e0b;
        }
        .api-test {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
        }
        .api-test pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
        }
        .summary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .summary h2 {
            margin: 0 0 12px 0;
            font-size: 24px;
        }
        .summary p {
            margin: 0;
            font-size: 16px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Test Correction Filtres Avanc√©s</h1>
        <p>TaskMaster AI - Validation de la correction du probl√®me de valorisation des filtres</p>
    </div>

    <div class="container">
        <div class="test-section" id="test1">
            <div class="test-title">
                <span class="status-indicator pending" id="indicator1"></span>
                Test 1: S√©lection "Toutes les r√©gions"
            </div>
            <div class="test-result" id="result1">En attente...</div>
            <div class="test-description">
                V√©rifier que la s√©lection "Toutes les r√©gions" dans le filtre R√©gion fonctionne correctement
            </div>
            <div class="test-steps">
                <strong>√âtapes de test :</strong>
                <ol>
                    <li>Ouvrir la page des exportateurs</li>
                    <li>Cliquer sur "Filtres avanc√©s"</li>
                    <li>S√©lectionner "Toutes les r√©gions" dans la liste d√©roulante R√©gion</li>
                    <li>V√©rifier que le champ est bien valoris√©</li>
                    <li>V√©rifier que la requ√™te API ne contient pas le param√®tre regionCode</li>
                </ol>
            </div>
            <div class="api-test">
                <strong>Test API :</strong>
                <button onclick="testRegionFilter()">Tester le filtre r√©gion</button>
                <pre id="regionResult">Cliquez sur le bouton pour tester...</pre>
            </div>
        </div>

        <div class="test-section" id="test2">
            <div class="test-title">
                <span class="status-indicator pending" id="indicator2"></span>
                Test 2: S√©lection "Tous les types"
            </div>
            <div class="test-result" id="result2">En attente...</div>
            <div class="test-description">
                V√©rifier que la s√©lection "Tous les types" dans le filtre Type fonctionne correctement
            </div>
            <div class="test-steps">
                <strong>√âtapes de test :</strong>
                <ol>
                    <li>Ouvrir la page des exportateurs</li>
                    <li>Cliquer sur "Filtres avanc√©s"</li>
                    <li>S√©lectionner "Tous les types" dans la liste d√©roulante Type</li>
                    <li>V√©rifier que le champ est bien valoris√©</li>
                    <li>V√©rifier que la requ√™te API ne contient pas le param√®tre type</li>
                </ol>
            </div>
            <div class="api-test">
                <strong>Test API :</strong>
                <button onclick="testTypeFilter()">Tester le filtre type</button>
                <pre id="typeResult">Cliquez sur le bouton pour tester...</pre>
            </div>
        </div>

        <div class="test-section" id="test3">
            <div class="test-title">
                <span class="status-indicator pending" id="indicator3"></span>
                Test 3: S√©lection "Tous les statuts"
            </div>
            <div class="test-result" id="result3">En attente...</div>
            <div class="test-description">
                V√©rifier que la s√©lection "Tous les statuts" dans le filtre Statut fonctionne correctement
            </div>
            <div class="test-steps">
                <strong>√âtapes de test :</strong>
                <ol>
                    <li>Ouvrir la page des exportateurs</li>
                    <li>Cliquer sur "Filtres avanc√©s"</li>
                    <li>S√©lectionner "Tous les statuts" dans la liste d√©roulante Statut</li>
                    <li>V√©rifier que le champ est bien valoris√©</li>
                    <li>V√©rifier que la requ√™te API ne contient pas le param√®tre statut</li>
                </ol>
            </div>
            <div class="api-test">
                <strong>Test API :</strong>
                <button onclick="testStatutFilter()">Tester le filtre statut</button>
                <pre id="statutResult">Cliquez sur le bouton pour tester...</pre>
            </div>
        </div>

        <div class="test-section" id="test4">
            <div class="test-title">
                <span class="status-indicator pending" id="indicator4"></span>
                Test 4: Combinaison de filtres
            </div>
            <div class="test-result" id="result4">En attente...</div>
            <div class="test-description">
                V√©rifier que la combinaison de plusieurs filtres fonctionne correctement
            </div>
            <div class="test-steps">
                <strong>√âtapes de test :</strong>
                <ol>
                    <li>S√©lectionner une r√©gion sp√©cifique (ex: "Bissau")</li>
                    <li>S√©lectionner un type sp√©cifique (ex: "Exportateur")</li>
                    <li>Laisser le statut sur "Tous les statuts"</li>
                    <li>V√©rifier que seuls les filtres non-vides sont envoy√©s √† l'API</li>
                </ol>
            </div>
            <div class="api-test">
                <strong>Test API :</strong>
                <button onclick="testCombinedFilters()">Tester les filtres combin√©s</button>
                <pre id="combinedResult">Cliquez sur le bouton pour tester...</pre>
            </div>
        </div>

        <div class="test-section" id="test5">
            <div class="test-title">
                <span class="status-indicator pending" id="indicator5"></span>
                Test 5: Affichage des filtres actifs
            </div>
            <div class="test-result" id="result5">En attente...</div>
            <div class="test-description">
                V√©rifier que les filtres avec des valeurs vides ne s'affichent pas dans la section "Filtres actifs"
            </div>
            <div class="test-steps">
                <strong>√âtapes de test :</strong>
                <ol>
                    <li>S√©lectionner "Toutes les r√©gions"</li>
                    <li>S√©lectionner un type sp√©cifique</li>
                    <li>S√©lectionner "Tous les statuts"</li>
                    <li>V√©rifier que seuls le type appara√Æt dans "Filtres actifs"</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="summary" id="summary" style="display: none;">
        <h2>üéâ Tests Termin√©s</h2>
        <p id="summaryText">Tous les tests ont √©t√© ex√©cut√©s avec succ√®s !</p>
    </div>

    <script>
        async function testRegionFilter() {
            const resultElement = document.getElementById('regionResult');
            resultElement.textContent = 'Test en cours...';
            
            try {
                // Test 1: Sans filtre r√©gion (devrait retourner tous les exportateurs)
                const response1 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5');
                const data1 = await response1.json();
                
                // Test 2: Avec filtre r√©gion vide (devrait √™tre identique au test 1)
                const response2 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&regionCode=');
                const data2 = await response2.json();
                
                // Test 3: Avec une r√©gion sp√©cifique
                const response3 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&regionCode=BS');
                const data3 = await response3.json();
                
                const result = {
                    test1_sans_filtre: {
                        totalElements: data1.totalElements,
                        content: data1.content.length
                    },
                    test2_filtre_vide: {
                        totalElements: data2.totalElements,
                        content: data2.content.length
                    },
                    test3_filtre_region_bs: {
                        totalElements: data3.totalElements,
                        content: data3.content.length
                    },
                    validation: data1.totalElements === data2.totalElements ? 'PASSED' : 'FAILED'
                };
                
                resultElement.textContent = JSON.stringify(result, null, 2);
                
                if (result.validation === 'PASSED') {
                    updateTestResult('test1', 'PASSED', 'Le filtre r√©gion vide fonctionne correctement');
                } else {
                    updateTestResult('test1', 'FAILED', 'Le filtre r√©gion vide ne fonctionne pas');
                }
                
            } catch (error) {
                resultElement.textContent = `Erreur: ${error.message}`;
                updateTestResult('test1', 'FAILED', `Erreur: ${error.message}`);
            }
        }

        async function testTypeFilter() {
            const resultElement = document.getElementById('typeResult');
            resultElement.textContent = 'Test en cours...';
            
            try {
                // Test 1: Sans filtre type
                const response1 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5');
                const data1 = await response1.json();
                
                // Test 2: Avec filtre type vide
                const response2 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&type=');
                const data2 = await response2.json();
                
                // Test 3: Avec type sp√©cifique
                const response3 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&type=EXPORTATEUR');
                const data3 = await response3.json();
                
                const result = {
                    test1_sans_filtre: {
                        totalElements: data1.totalElements,
                        content: data1.content.length
                    },
                    test2_filtre_vide: {
                        totalElements: data2.totalElements,
                        content: data2.content.length
                    },
                    test3_filtre_type_exportateur: {
                        totalElements: data3.totalElements,
                        content: data3.content.length
                    },
                    validation: data1.totalElements === data2.totalElements ? 'PASSED' : 'FAILED'
                };
                
                resultElement.textContent = JSON.stringify(result, null, 2);
                
                if (result.validation === 'PASSED') {
                    updateTestResult('test2', 'PASSED', 'Le filtre type vide fonctionne correctement');
                } else {
                    updateTestResult('test2', 'FAILED', 'Le filtre type vide ne fonctionne pas');
                }
                
            } catch (error) {
                resultElement.textContent = `Erreur: ${error.message}`;
                updateTestResult('test2', 'FAILED', `Erreur: ${error.message}`);
            }
        }

        async function testStatutFilter() {
            const resultElement = document.getElementById('statutResult');
            resultElement.textContent = 'Test en cours...';
            
            try {
                // Test 1: Sans filtre statut
                const response1 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5');
                const data1 = await response1.json();
                
                // Test 2: Avec filtre statut vide
                const response2 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&statut=');
                const data2 = await response2.json();
                
                // Test 3: Avec statut sp√©cifique
                const response3 = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&statut=ACTIF');
                const data3 = await response3.json();
                
                const result = {
                    test1_sans_filtre: {
                        totalElements: data1.totalElements,
                        content: data1.content.length
                    },
                    test2_filtre_vide: {
                        totalElements: data2.totalElements,
                        content: data2.content.length
                    },
                    test3_filtre_statut_actif: {
                        totalElements: data3.totalElements,
                        content: data3.content.length
                    },
                    validation: data1.totalElements === data2.totalElements ? 'PASSED' : 'FAILED'
                };
                
                resultElement.textContent = JSON.stringify(result, null, 2);
                
                if (result.validation === 'PASSED') {
                    updateTestResult('test3', 'PASSED', 'Le filtre statut vide fonctionne correctement');
                } else {
                    updateTestResult('test3', 'FAILED', 'Le filtre statut vide ne fonctionne pas');
                }
                
            } catch (error) {
                resultElement.textContent = `Erreur: ${error.message}`;
                updateTestResult('test3', 'FAILED', `Erreur: ${error.message}`);
            }
        }

        async function testCombinedFilters() {
            const resultElement = document.getElementById('combinedResult');
            resultElement.textContent = 'Test en cours...';
            
            try {
                // Test avec combinaison de filtres
                const response = await fetch('http://localhost:8080/api/v1/exportateurs?page=0&size=5&regionCode=BS&type=EXPORTATEUR&statut=');
                const data = await response.json();
                
                const result = {
                    filters_applied: {
                        regionCode: 'BS',
                        type: 'EXPORTATEUR',
                        statut: '"" (vide)'
                    },
                    response: {
                        totalElements: data.totalElements,
                        content: data.content.length,
                        firstItem: data.content[0] ? {
                            nom: data.content[0].nom,
                            regionCode: data.content[0].regionCode,
                            type: data.content[0].type
                        } : null
                    },
                    validation: data.content.length > 0 ? 'PASSED' : 'FAILED'
                };
                
                resultElement.textContent = JSON.stringify(result, null, 2);
                
                if (result.validation === 'PASSED') {
                    updateTestResult('test4', 'PASSED', 'Les filtres combin√©s fonctionnent correctement');
                } else {
                    updateTestResult('test4', 'FAILED', 'Les filtres combin√©s ne fonctionnent pas');
                }
                
            } catch (error) {
                resultElement.textContent = `Erreur: ${error.message}`;
                updateTestResult('test4', 'FAILED', `Erreur: ${error.message}`);
            }
        }

        function updateTestResult(testId, status, message) {
            const testSection = document.getElementById(testId);
            const indicator = document.getElementById(`indicator${testId.charAt(testId.length-1)}`);
            const result = document.getElementById(`result${testId.charAt(testId.length-1)}`);
            
            if (status === 'PASSED') {
                testSection.classList.add('passed');
                indicator.classList.add('passed');
                indicator.classList.remove('pending');
                result.textContent = '‚úÖ ' + message;
                result.classList.add('passed');
            } else {
                testSection.classList.add('failed');
                indicator.classList.add('failed');
                indicator.classList.remove('pending');
                result.textContent = '‚ùå ' + message;
                result.classList.add('failed');
            }
            
            // V√©rifier si tous les tests sont termin√©s
            checkAllTestsCompleted();
        }

        function checkAllTestsCompleted() {
            const indicators = document.querySelectorAll('.status-indicator');
            const allCompleted = Array.from(indicators).every(indicator => 
                indicator.classList.contains('passed') || indicator.classList.contains('failed')
            );
            
            if (allCompleted) {
                const passedTests = Array.from(indicators).filter(indicator => 
                    indicator.classList.contains('passed')
                ).length;
                
                const summary = document.getElementById('summary');
                const summaryText = document.getElementById('summaryText');
                
                summary.style.display = 'block';
                summaryText.textContent = `${passedTests}/${indicators.length} tests r√©ussis`;
                
                if (passedTests === indicators.length) {
                    summaryText.textContent = 'üéâ Tous les tests ont √©t√© r√©ussis ! La correction fonctionne parfaitement.';
                }
            }
        }

        // Test automatique de l'affichage des filtres actifs (simulation)
        function testActiveFiltersDisplay() {
            // Simuler le comportement des filtres actifs
            const mockFilters = {
                regionCode: '',
                type: 'EXPORTATEUR',
                statut: ''
            };
            
            const hasActiveFilters = Object.values(mockFilters).some(value => value !== undefined && value !== '');
            const activeFiltersCount = Object.values(mockFilters).filter(value => value !== undefined && value !== '').length;
            
            const result = {
                mockFilters: mockFilters,
                hasActiveFilters: hasActiveFilters,
                activeFiltersCount: activeFiltersCount,
                expectedDisplay: activeFiltersCount === 1 ? 'Seul le type devrait s\'afficher' : 'Erreur dans la logique'
            };
            
            console.log('Test filtres actifs:', result);
            
            if (activeFiltersCount === 1) {
                updateTestResult('test5', 'PASSED', 'L\'affichage des filtres actifs fonctionne correctement');
            } else {
                updateTestResult('test5', 'FAILED', 'L\'affichage des filtres actifs ne fonctionne pas');
            }
        }

        // Lancer le test des filtres actifs automatiquement
        setTimeout(testActiveFiltersDisplay, 1000);
    </script>
</body>
</html>
