<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Filtres Exportateurs - Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Test Filtres Exportateurs - Debug</h1>
    
    <div class="test-section">
        <h2>Test API de base</h2>
        <button onclick="testBasicAPI()">Test API de base</button>
        <div id="basic-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test Filtres</h2>
        <div>
            <label>Type:</label>
            <select id="type-filter">
                <option value="">Tous les types</option>
                <option value="EXPORTATEUR">Exportateur</option>
                <option value="ACHETEUR_LOCAL">Acheteur Local</option>
            </select>
            
            <label>Région:</label>
            <select id="region-filter">
                <option value="">Toutes les régions</option>
                <option value="BF">Bafatá</option>
                <option value="BS">Bissau</option>
                <option value="CA">Cacheu</option>
                <option value="GA">Gabú</option>
            </select>
            
            <label>Nom:</label>
            <input type="text" id="nom-filter" placeholder="Rechercher par nom...">
            
            <button onclick="testFilters()">Test Filtres</button>
        </div>
        <div id="filter-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test Filtres Individuels</h2>
        <button onclick="testTypeFilter()">Test Filtre Type</button>
        <button onclick="testRegionFilter()">Test Filtre Région</button>
        <button onclick="testNomFilter()">Test Filtre Nom</button>
        <div id="individual-result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1/exportateurs';
        
        async function testBasicAPI() {
            const resultDiv = document.getElementById('basic-result');
            resultDiv.innerHTML = 'Test en cours...';
            
            try {
                const response = await fetch(`${API_BASE}?page=0&size=5`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>✅ API fonctionne</h3>
                        <p>Résultats: ${data.content.length}</p>
                        <pre>${JSON.stringify(data.content.map(e => ({nom: e.nom, type: e.type, regionCode: e.regionCode})), null, 2)}</pre>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Erreur API</h3><p>${error.message}</p>`;
            }
        }
        
        async function testFilters() {
            const resultDiv = document.getElementById('filter-result');
            resultDiv.innerHTML = 'Test en cours...';
            
            const type = document.getElementById('type-filter').value;
            const region = document.getElementById('region-filter').value;
            const nom = document.getElementById('nom-filter').value;
            
            const params = new URLSearchParams();
            params.append('page', '0');
            params.append('size', '10');
            if (type) params.append('type', type);
            if (region) params.append('regionCode', region);
            if (nom) params.append('nom', nom);
            
            try {
                const response = await fetch(`${API_BASE}?${params}`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>✅ Filtres testés</h3>
                        <p>Paramètres: type=${type || 'null'}, region=${region || 'null'}, nom=${nom || 'null'}</p>
                        <p>Résultats: ${data.content.length}</p>
                        <pre>${JSON.stringify(data.content.map(e => ({nom: e.nom, type: e.type, regionCode: e.regionCode})), null, 2)}</pre>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Erreur Filtres</h3><p>${error.message}</p>`;
            }
        }
        
        async function testTypeFilter() {
            const resultDiv = document.getElementById('individual-result');
            resultDiv.innerHTML = 'Test filtre type en cours...';
            
            try {
                const response = await fetch(`${API_BASE}?page=0&size=5&type=EXPORTATEUR`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>✅ Test Filtre Type (EXPORTATEUR)</h3>
                        <p>Résultats: ${data.content.length}</p>
                        <pre>${JSON.stringify(data.content.map(e => ({nom: e.nom, type: e.type})), null, 2)}</pre>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Erreur Filtre Type</h3><p>${error.message}</p>`;
            }
        }
        
        async function testRegionFilter() {
            const resultDiv = document.getElementById('individual-result');
            resultDiv.innerHTML = 'Test filtre région en cours...';
            
            try {
                const response = await fetch(`${API_BASE}?page=0&size=5&regionCode=BF`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>✅ Test Filtre Région (BF)</h3>
                        <p>Résultats: ${data.content.length}</p>
                        <pre>${JSON.stringify(data.content.map(e => ({nom: e.nom, regionCode: e.regionCode})), null, 2)}</pre>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Erreur Filtre Région</h3><p>${error.message}</p>`;
            }
        }
        
        async function testNomFilter() {
            const resultDiv = document.getElementById('individual-result');
            resultDiv.innerHTML = 'Test filtre nom en cours...';
            
            try {
                const response = await fetch(`${API_BASE}?page=0&size=5&nom=Cajou`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>✅ Test Filtre Nom (Cajou)</h3>
                        <p>Résultats: ${data.content.length}</p>
                        <pre>${JSON.stringify(data.content.map(e => ({nom: e.nom})), null, 2)}</pre>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>❌ Erreur Filtre Nom</h3><p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
